# MasterTable
This project is currently under development.

However, I opened source the development process :)

And This is a mini-project I'm working on to study the Roslyn source generator. But, this tool is very practical!!!
 
## Summary
This project is a library for handling game data tables. It is optimized for handling row and column data in Excel, Google Sheet, etc.




-----

### Features
**No Reflection** :  MasterMemory is using the Roslyn Source Generator to minimize GC caused by reflections.  

**Custom Type** : You can implment CustomType inherit IType<T> and you can create any text to object/value parser you want. I have optimized the call to the IType<T>.Read function with Roslyn so that there are no unnecessary GCs in converting the string to a C# instance.

**Async-friendly design** : By default, it is designed to use an asynchronous grammar (UniTask).

**Programmer-friendly** : The code generated by MasterMemory Roslyn is easy to use, even for novice developers.  The approach to entity data in tables is itself very intuitive.

**Very fastest** : The fastest table tool in existence.


## How to use
### 작성예정

일반적인 구조 

1. 엑셀/시트 등에서 Virtual Spread Sheet를 만든다
2. Virtual Spread Sheet를 직렬화해서 저장한다.
3. SpreadSheetStruct 구조는 코드 제너레이션을 위해 json 저장한다.
4. 코드 제너레이션을 통해 C# 코드를 생성한다.
5. 생성된 코드를 사용한다.
6. 행복해지자.


Roslyn에서 자동으로 만든 코드 예시

```csharp
using MasterTable;
using MasterTable.Core;
using System.Collections;
using GameDB.Core;
using System.Collections.Generic;
using Cysharp.Threading.Tasks;

namespace GameDB
{ h
    public partial class Unit : ISchema
    {
        public Data DataTable { get; private set; } = new Data();
        public Level LevelTable { get; private set; } = new Level();

        private List<IncludedTable> _included;
        public List<IncludedTable> g_Included => _included ??= new List<IncludedTable>()
        {
            new IncludedTable()
            {
                Name = "Data",
                SchemaName = "Unit",
                SchemaId = "Unit",
                Id = "Data"
            },
            new IncludedTable()
            {
                Name = "Level",
                SchemaName = "Unit",
                SchemaId = "Unit",
                Id = "Level"
            }
        };

        /*Auto Generated Tables*/
        /*---------------------Table Start---------------------*/
        public partial class Data : ITable<Unit>, IEnumerable<Data.Entity>
        {
            /*---------------------Entity Start---------------------*/
            public partial class Entity : IEntity<Data>
            {
                public int Key { get; private set; }
                public float Damage { get; private set; }
                public double Percentage { get; private set; }
                public global::System.Collections.Generic.List<int> Datas { get; private set; }

                public static Entity CreateWithVirtualCells(List<global::MasterTable.Core.VirtualCell> values)
                {
                    Entity entity = new Entity();
                    entity.Key = TypeReader<int>.Reader.Read(values[0].Value);
                    entity.Damage = TypeReader<float>.Reader.Read(values[1].Value);
                    entity.Percentage = TypeReader<double>.Reader.Read(values[2].Value);
                    entity.Datas = TypeReader<global::System.Collections.Generic.List<int>>.Reader.Read(values[3].Value);
                    return entity;
                }
            }

            /*---------------------Entity End---------------------*/
            /*---------------------DataField Start---------------------*/
            private global::System.Collections.Generic.List<GameDB.Unit.Data.Entity> _list = new();
            private global::System.Collections.Generic.Dictionary<int, GameDB.Unit.Data.Entity> _map = new();
            public global::System.Collections.Generic.IReadOnlyList<GameDB.Unit.Data.Entity> List => _list;
            public global::System.Collections.Generic.IReadOnlyDictionary<int, GameDB.Unit.Data.Entity> Map => _map;

            public Entity Get(int key)
            {
                if (Map.ContainsKey(key))
                    return Map[key];
                return null;
            }

            public bool IsExist(int key)
            {
                return Map.ContainsKey(key);
            }

            public IEnumerator<Entity> GetEnumerator()
            {
                return List.GetEnumerator();
            }

            IEnumerator IEnumerable.GetEnumerator()
            {
                return GetEnumerator();
            }

            public Entity this[int i]
            {
                get
                {
                    return Get(i);
                }
            }

            public int Count => List.Count;

            public async UniTask LoadAsync(global::MasterTable.Core.VirtualSheet sheet)
            {
                _list.Clear();
                _map.Clear();
                int dataCount = sheet.DataRanges.Table.Count;
                int perRead = dataCount > 128 ? dataCount / 8 : 0;
                int loadedCount = 0;
                for (int i = 0; i < sheet.DataRanges.Table.Count; i++)
                {
                    Entity entity = Entity.CreateWithVirtualCells(sheet.DataRanges.Table[i]);
                    if (!Map.ContainsKey(entity.Key))
                    {
                        _list.Add(entity);
                        _map.Add(entity.Key, entity);
                        loadedCount++;
                        if (perRead > 0 && perRead == loadedCount)
                        {
                            await UniTask.Yield();
                        }
                    }
                    else
                    {
                        throw new System.Exception($"{entity.Key} is already exist in the table! (key value must be unique..)");
                    }
                }
            }
        }

        /*---------------------DataField End---------------------*/
        /*---------------------Table End---------------------*/
        /*---------------------Table Start---------------------*/
        public partial class Level : ITable<Unit>, IEnumerable<Level.Entity>
        {
            /*---------------------Entity Start---------------------*/
            public partial class Entity : IEntity<Level>
            {
                public int Key { get; private set; }
                public int Level { get; private set; }
                public float Miyao { get; private set; }
                public global::System.Collections.Generic.List<int> ListList { get; private set; }

                public static Entity CreateWithVirtualCells(List<global::MasterTable.Core.VirtualCell> values)
                {
                    Entity entity = new Entity();
                    entity.Key = TypeReader<int>.Reader.Read(values[0].Value);
                    entity.Level = TypeReader<int>.Reader.Read(values[1].Value);
                    entity.Miyao = TypeReader<float>.Reader.Read(values[2].Value);
                    entity.ListList = TypeReader<global::System.Collections.Generic.List<int>>.Reader.Read(values[3].Value);
                    return entity;
                }
            }

            /*---------------------Entity End---------------------*/
            /*---------------------LevelField Start---------------------*/
            private global::System.Collections.Generic.List<GameDB.Unit.Level.Entity> _list = new();
            private global::System.Collections.Generic.Dictionary<int, GameDB.Unit.Level.Entity> _map = new();
            public global::System.Collections.Generic.IReadOnlyList<GameDB.Unit.Level.Entity> List => _list;
            public global::System.Collections.Generic.IReadOnlyDictionary<int, GameDB.Unit.Level.Entity> Map => _map;

            public Entity Get(int key)
            {
                if (Map.ContainsKey(key))
                    return Map[key];
                return null;
            }

            public bool IsExist(int key)
            {
                return Map.ContainsKey(key);
            }

            public IEnumerator<Entity> GetEnumerator()
            {
                return List.GetEnumerator();
            }

            IEnumerator IEnumerable.GetEnumerator()
            {
                return GetEnumerator();
            }

            public Entity this[int i]
            {
                get
                {
                    return Get(i);
                }
            }

            public int Count => List.Count;

            public async UniTask LoadAsync(global::MasterTable.Core.VirtualSheet sheet)
            {
                _list.Clear();
                _map.Clear();
                int dataCount = sheet.DataRanges.Table.Count;
                int perRead = dataCount > 128 ? dataCount / 8 : 0;
                int loadedCount = 0;
                for (int i = 0; i < sheet.DataRanges.Table.Count; i++)
                {
                    Entity entity = Entity.CreateWithVirtualCells(sheet.DataRanges.Table[i]);
                    if (!Map.ContainsKey(entity.Key))
                    {
                        _list.Add(entity);
                        _map.Add(entity.Key, entity);
                        loadedCount++;
                        if (perRead > 0 && perRead == loadedCount)
                        {
                            await UniTask.Yield();
                        }
                    }
                    else
                    {
                        throw new System.Exception($"{entity.Key} is already exist in the table! (key value must be unique..)");
                    }
                }
            }
        }
    /*---------------------LevelField End---------------------*/
    /*---------------------Table End---------------------*/
    }
/*---------------------Schema End---------------------*/
}
```